# ru-pills.com - Docker Infrastructure

–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è WordPress —Å–∞–π—Ç–∞ ru-pills.com

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç](#–±—ã—Å—Ç—Ä—ã–π-—Å—Ç–∞—Ä—Ç)
- [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞](#—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–ø—Ä–æ–µ–∫—Ç–∞)
- [–ë—ç–∫–∞–ø—ã](#–±—ç–∫–∞–ø—ã)
- [–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ](#–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ)
- [Docker –∫–æ–º–∞–Ω–¥—ã](#docker-–∫–æ–º–∞–Ω–¥—ã)
- [GitHub](#github)

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Docker –∏ Docker Compose
- Git

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞

1. **–ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:**
```bash
git clone https://github.com/your-username/rupills-infra.git
cd rupills-infra
```

2. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
```bash
cp .env.example .env
nano .env  # –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–∞—Ä–æ–ª–∏ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
```

3. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã:**
```bash
docker-compose up -d
```

4. **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ WordPress core –∏–∑ –±—ç–∫–∞–ø–∞:**
```bash
./scripts/restore.sh wp
```
–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫–∞—á–∞–µ—Ç —Ç—É –∂–µ –≤–µ—Ä—Å–∏—é WordPress, –∫–æ—Ç–æ—Ä–∞—è –±—ã–ª–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –≤ –±—ç–∫–∞–ø–µ.

5. **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–ª–∞–≥–∏–Ω—ã –∏–∑ –±—ç–∫–∞–ø–∞:**
```bash
./scripts/restore.sh plugins
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
/var/www/
‚îú‚îÄ‚îÄ docker-compose.yml      # Docker Compose –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ Dockerfile              # –û–±—Ä–∞–∑ OpenLiteSpeed
‚îú‚îÄ‚îÄ .env.example            # –ü—Ä–∏–º–µ—Ä –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ .gitignore              # –ò—Å–∫–ª—é—á–µ–Ω–∏—è –¥–ª—è Git
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îú‚îÄ‚îÄ backup-db.sh        # –ë—ç–∫–∞–ø –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ backup-plugins.sh   # –ë—ç–∫–∞–ø –ø–ª–∞–≥–∏–Ω–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ backup-all.sh       # –ü–æ–ª–Ω—ã–π –±—ç–∫–∞–ø
‚îÇ   ‚îî‚îÄ‚îÄ restore.sh          # –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –±—ç–∫–∞–ø–æ–≤
‚îú‚îÄ‚îÄ html/                   # WordPress —Ñ–∞–π–ª—ã
‚îÇ   ‚îú‚îÄ‚îÄ .htaccess           # –ü—Ä–∞–≤–∏–ª–∞ —Ä–µ–¥–∏—Ä–µ–∫—Ç–æ–≤ –∏ LiteSpeed Cache
‚îÇ   ‚îú‚îÄ‚îÄ wp-content/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ .litespeed_conf.dat  # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è LiteSpeed Cache
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ themes/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ flatsome/        # –†–æ–¥–∏—Ç–µ–ª—å—Å–∫–∞—è —Ç–µ–º–∞ (–±—ç–∫–∞–ø)
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ flatsome-child/  # –î–æ—á–µ—Ä–Ω—è—è —Ç–µ–º–∞ (–≤ Git)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ plugins/              # –ü–ª–∞–≥–∏–Ω—ã (–±—ç–∫–∞–ø)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ mu-plugins/           # Must-use –ø–ª–∞–≥–∏–Ω—ã (–±—ç–∫–∞–ø)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ fonts/                # –ö–∞—Å—Ç–æ–º–Ω—ã–µ —à—Ä–∏—Ñ—Ç—ã (–±—ç–∫–∞–ø)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ languages/            # –ü–µ—Ä–µ–≤–æ–¥—ã (–±—ç–∫–∞–ø)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ uploads/              # –ó–∞–≥—Ä—É–∑–∫–∏ (–±—ç–∫–∞–ø)
‚îÇ   ‚îî‚îÄ‚îÄ backup-download.php # –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –±—ç–∫–∞–ø–æ–≤
‚îî‚îÄ‚îÄ backups/                # –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è –±—ç–∫–∞–ø–æ–≤
```

## üíæ –ë—ç–∫–∞–ø—ã

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã

–ù–∞—Å—Ç—Ä–æ–π—Ç–µ cron –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –±—ç–∫–∞–ø–æ–≤:

```bash
# –î–æ–±–∞–≤—å—Ç–µ –≤ crontab (crontab -e)
0 */6 * * * /var/www/scripts/backup-all.sh >> /var/www/backups/backup.log 2>&1
```

–≠—Ç–æ —Å–æ–∑–¥–∞—Å—Ç –±—ç–∫–∞–ø—ã –∫–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤:
- –í–µ—Ä—Å–∏—è WordPress (wp-version-latest.txt)
- –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (db-latest.sql.gz)
- –ü–ª–∞–≥–∏–Ω—ã (plugins-latest.tar.gz)
- Uploads (uploads-latest.tar.gz)
- wp-config.php (wp-config-latest.enc - –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω)
- –î–æ—á–µ—Ä–Ω—è—è —Ç–µ–º–∞ flatsome-child (flatsome-child-latest.tar.gz)
- –†–æ–¥–∏—Ç–µ–ª—å—Å–∫–∞—è —Ç–µ–º–∞ Flatsome (flatsome-latest.tar.gz)
- Must-use –ø–ª–∞–≥–∏–Ω—ã (mu-plugins-latest.tar.gz)
- –ö–∞—Å—Ç–æ–º–Ω—ã–µ —à—Ä–∏—Ñ—Ç—ã (fonts-latest.tar.gz)
- –ü–µ—Ä–µ–≤–æ–¥—ã WordPress (languages-latest.tar.gz)
- –§–∞–π–ª .htaccess (htaccess-latest.txt)
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è LiteSpeed Cache (litespeed_conf-latest.dat)

### –†—É—á–Ω–æ–π –±—ç–∫–∞–ø

```bash
# –ü–æ–ª–Ω—ã–π –±—ç–∫–∞–ø
./scripts/backup-all.sh

# –¢–æ–ª—å–∫–æ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
./scripts/backup-db.sh

# –¢–æ–ª—å–∫–æ –ø–ª–∞–≥–∏–Ω—ã
./scripts/backup-plugins.sh
```

### –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è

1. **–û—Ç–∫—Ä–æ–π—Ç–µ:** `https://ru-pills.com/backup-download.php`
2. **–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å** (–Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –≤ —Ñ–∞–π–ª–µ `backup-download.php`)
3. **–°–∫–∞—á–∞–π—Ç–µ –Ω—É–∂–Ω—ã–µ —Ñ–∞–π–ª—ã**

‚ö†Ô∏è **–í–ê–ñ–ù–û:** –ò–∑–º–µ–Ω–∏—Ç–µ –ø–∞—Ä–æ–ª—å –≤ `html/backup-download.php`:
```php
$BACKUP_PASSWORD = 'your_secure_password_here';
```

## üîÑ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ

### –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞ –Ω–æ–≤–æ–º —Å–µ—Ä–≤–µ—Ä–µ

1. **–ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:**
```bash
git clone https://github.com/your-username/rupills-infra.git
cd rupills-infra
```

2. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ .env:**
```bash
cp .env.example .env
nano .env
```

3. **–°–∫–∞—á–∞–π—Ç–µ –±—ç–∫–∞–ø—ã:**
   - –ó–∞–π–¥–∏—Ç–µ –Ω–∞ `https://ru-pills.com/backup-download.php`
   - –°–∫–∞—á–∞–π—Ç–µ –≤—Å–µ —Ñ–∞–π–ª—ã —Å —Å—É—Ñ—Ñ–∏–∫—Å–æ–º `-latest`

4. **–ü–æ–º–µ—Å—Ç–∏—Ç–µ –±—ç–∫–∞–ø—ã –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é:**
```bash
mkdir -p backups
# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–∫–∞—á–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –≤ backups/
```

5. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ Docker:**
```bash
docker-compose up -d db redis
# –ü–æ–¥–æ–∂–¥–∏—Ç–µ 10 —Å–µ–∫—É–Ω–¥ –ø–æ–∫–∞ –ë–î –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è
```

6. **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ WordPress core (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫–∞—á–∞–µ—Ç—Å—è –Ω—É–∂–Ω–∞—è –≤–µ—Ä—Å–∏—è):**
```bash
./scripts/restore.sh wp
```

7. **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –≤—Å—ë –æ—Å—Ç–∞–ª—å–Ω–æ–µ:**
```bash
./scripts/restore.sh all
```

8. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä:**
```bash
docker-compose up -d web
```

8. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞:**
```bash
docker-compose exec web chown -R lsadm:lsadm /var/www/html
```

### –ß–∞—Å—Ç–∏—á–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ

```bash
# –¢–æ–ª—å–∫–æ WordPress core (—Å–∫–∞—á–∞–µ—Ç –≤–µ—Ä—Å–∏—é –∏–∑ –±—ç–∫–∞–ø–∞)
./scripts/restore.sh wp

# –¢–æ–ª—å–∫–æ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
./scripts/restore.sh db

# –¢–æ–ª—å–∫–æ –ø–ª–∞–≥–∏–Ω—ã
./scripts/restore.sh plugins

# –¢–æ–ª—å–∫–æ uploads
./scripts/restore.sh uploads

# –¢–æ–ª—å–∫–æ –¥–æ—á–µ—Ä–Ω—è—è —Ç–µ–º–∞
./scripts/restore.sh theme

# –¢–æ–ª—å–∫–æ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∞—è —Ç–µ–º–∞ Flatsome
./scripts/restore.sh flatsome

# –¢–æ–ª—å–∫–æ mu-plugins
./scripts/restore.sh muplugins

# –¢–æ–ª—å–∫–æ —à—Ä–∏—Ñ—Ç—ã
./scripts/restore.sh fonts

# –¢–æ–ª—å–∫–æ –ø–µ—Ä–µ–≤–æ–¥—ã
./scripts/restore.sh languages

# –¢–æ–ª—å–∫–æ .htaccess
./scripts/restore.sh htaccess

# –¢–æ–ª—å–∫–æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è LiteSpeed
./scripts/restore.sh litespeed
```

## üê≥ Docker –∫–æ–º–∞–Ω–¥—ã

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose up -d

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose down

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker-compose logs -f web

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞
docker-compose restart web

# –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
docker-compose exec web wp plugin list
docker-compose exec db mysql -u wordpress -p wordpress
```

### –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã WP-CLI

```bash
# –°–ø–∏—Å–æ–∫ –ø–ª–∞–≥–∏–Ω–æ–≤
docker-compose exec web wp plugin list

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ WordPress core
docker-compose exec web wp core update

# –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞
docker-compose exec web wp cache flush

# –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ë–î
docker-compose exec web wp db optimize
```

## üì§ GitHub

### –ß—Ç–æ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ Git

‚úÖ **–•—Ä–∞–Ω–∏—Ç—Å—è:**
- Docker –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (docker-compose.yml, Dockerfile)
- –°–∫—Ä–∏–ø—Ç—ã –±—ç–∫–∞–ø–∞ –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
- –ö–∞—Å—Ç–æ–º–Ω–∞—è —Ç–µ–º–∞ `flatsome-child/`
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
- README –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

‚ùå **–ù–ï —Ö—Ä–∞–Ω–∏—Ç—Å—è:**
- WordPress core (—Å–∫–∞—á–∏–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
- –ü–ª–∞–≥–∏–Ω—ã (–≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è –∏–∑ –±—ç–∫–∞–ø–æ–≤)
- Uploads (–≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è –∏–∑ –±—ç–∫–∞–ø–æ–≤)
- wp-config.php (–≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –∏–∑ –±—ç–∫–∞–ø–∞)
- –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (–≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –∏–∑ –±—ç–∫–∞–ø–∞)

### –ü–µ—Ä–≤—ã–π –∫–æ–º–º–∏—Ç

```bash
cd /var/www
git init
git add .
git commit -m "Initial commit: Docker infrastructure for ru-pills.com"
git branch -M main
git remote add origin https://github.com/your-username/rupills-infra.git
git push -u origin main
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```bash
git add .
git commit -m "Update: –æ–ø–∏—Å–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π"
git push
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

1. **–ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∫–æ–º–º–∏—Ç—å—Ç–µ:**
   - `.env` —Ñ–∞–π–ª
   - `wp-config.php`
   - –ü–ª–∞–≥–∏–Ω—ã (–æ—Å–æ–±–µ–Ω–Ω–æ –∫—Ä—è–∫–Ω—É—Ç—ã–µ)
   - –ü–∞—Ä–æ–ª–∏ –∏ —Å–µ–∫—Ä–µ—Ç–Ω—ã–µ –∫–ª—é—á–∏

2. **–ó–∞—â–∏—Ç–∏—Ç–µ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –±—ç–∫–∞–ø–æ–≤:**
   - –ò–∑–º–µ–Ω–∏—Ç–µ –ø–∞—Ä–æ–ª—å –≤ `backup-download.php`
   - –†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ IP-–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π —á–µ—Ä–µ–∑ .htaccess

3. **–®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ wp-config.php:**
   - –ë—ç–∫–∞–ø—ã wp-config.php –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —à–∏—Ñ—Ä—É—é—Ç—Å—è
   - –ü–∞—Ä–æ–ª—å –¥–ª—è —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∏ —É–∫–∞–∑–∞–Ω –≤ –ª–æ–≥–µ –±—ç–∫–∞–ø–∞

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
1. –õ–æ–≥–∏ Docker: `docker-compose logs`
2. –õ–æ–≥–∏ –±—ç–∫–∞–ø–æ–≤: `cat backups/backup-*.log`
3. –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞: `ls -la html/`

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è.
